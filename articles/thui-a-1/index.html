<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="renderer" content="webkit">
  
  <meta name="format-detection" content="telephone=no,email=no">
  <meta name="theme-color" content="#9C27B0">
  <meta name="description" content="轻松处理应用内页面导航">
  <meta name="keywords" content=",Android,Kotlin">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="UNIDY&#39;s Timeline">
  <meta name="msapplication-starturl" content="https://www.unidy.cn/articles/thui-a-1/">
  <meta name="msapplication-navbutton-color" content="#9C27B0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="UNIDY&#39;s Timeline">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/images/unidy.png">

  <title>THUInfo踩坑记录（一） | UNIDY&#39;s Timeline</title>
  <link rel="shortcut icon" href="/images/unidy.png">
  
  <meta name="description" content="轻松处理应用内页面导航">
<meta property="og:type" content="article">
<meta property="og:title" content="THUInfo踩坑记录（一）">
<meta property="og:url" content="https://www.unidy.cn/articles/thui-a-1/">
<meta property="og:site_name" content="UNIDY&#39;s Timeline">
<meta property="og:description" content="轻松处理应用内页面导航">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.unidy.cn/articles/thui-a-1/drawer.png">
<meta property="article:published_time" content="2020-02-13T00:00:00.000Z">
<meta property="article:modified_time" content="2022-11-18T10:12:28.933Z">
<meta property="article:author" content="UNIDY">
<meta property="article:tag" content="Android">
<meta property="article:tag" content="Kotlin">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.unidy.cn/articles/thui-a-1/drawer.png">

  
  <meta property="article:published_time" content="Thu Feb 13 2020 00:00:00 GMT+0000">
  <meta property="article:modified_time" content="Fri Nov 18 2022 10:12:28 GMT+0000">
  

  
  <link rel="canonical" href="https://www.unidy.cn/articles/thui-a-1/">
  

  
  

  
  
  

  
<link rel="stylesheet" href="https://unpkg.com/mdui@1.0.1/dist/css/mdui.min.css">
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@5.15.4/css/fontawesome.min.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-appbar-with-toolbar mdui-drawer-body-left mdui-theme-primary-indigo mdui-theme-accent-pink">
  <script>var a=localStorage.getItem("mdui-theme-layout-dark");if(a){document.getElementsByTagName("body")[0].className+=" mdui-theme-layout-dark"};</script>
  <header id="header" class="mdui-appbar mdui-appbar-fixed mdui-appbar-scroll-hide mdui-appbar-inset">
    <div class="mdui-toolbar mdui-color-theme">
      <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-drawer="{target: '#sidebar', swipe: true}"><i class="mdui-icon material-icons">menu</i></a>
      <a href="/" class="mdui-typo-headline">UNIDY&#39;s Timeline</a>
      <div class="mdui-toolbar-spacer"></div>
      <a href="javascript:;" class="mdui-btn mdui-btn-icon" mdui-dialog="{target: '#search'}" mdui-tooltip="{content: '搜索'}"><i class="mdui-icon material-icons">search</i></a>
      
    </div>
  </header>
  <div class="mdui-dialog" id="search">
    
    <div class="search-form">
      <input type="search" class="search-form-input" placeholder="请输入关键字">
    </div>
    <div class="search-result" data-resource="/search.xml"></div>
    
  </div>
  <aside id="sidebar" class="mdui-drawer mdui-drawer-full-height">
    <div class="mdui-grid-tile">
      <img src="/images/banner.png" style="height: 160px;">
      <img src="/images/unidy.png" class="avatar-animation" style="position: absolute; top: 10%; left: 24px; width: 64px; height: 64px; border: 2px solid #fff; border-radius: 50%;">
      <div class="mdui-grid-tile-actions">
        <div class="mdui-grid-tile-text">
          <div class="mdui-grid-tile-title">UNIDY</div>
          <div class="mdui-grid-tile-subtitle"><i class="mdui-icon material-icons">art_track</i>Stay Hungry, Stay Foolish.</div>
        </div>
        
      </div>
    </div>

    <div class="mdui-list" mdui-collapse="{accordion: true}">
      <a href="/" class="mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">home</i>
        <div class="mdui-list-item-content">主页</div>
      </a>
      <div class="mdui-collapse-item">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-deep-orange">inbox</i>
          <div class="mdui-list-item-content">归档</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
          
          <a class="mdui-ripple sidebar_archives-link" href="/archives/2022/10/">十月 2022<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2022/09/">九月 2022<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2022/07/">七月 2022<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2022/06/">六月 2022<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2022/01/">一月 2022<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2021/06/">六月 2021<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2021/01/">一月 2021<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/06/">六月 2020<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/03/">三月 2020<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/02/">二月 2020<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2020/01/">一月 2020<span class="mdui-ripple sidebar_archives-count">1</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2019/12/">十二月 2019<span class="mdui-ripple sidebar_archives-count">2</span></a><a class="mdui-ripple sidebar_archives-link" href="/archives/2019/11/">十一月 2019<span class="mdui-ripple sidebar_archives-count">2</span></a>
          
        </div>
      </div>
      <div class="mdui-collapse-item">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-green">chrome_reader_mode</i>
          <div class="mdui-list-item-content">分类</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
          
          <a class="mdui-ripple sidebar_archives-link" href="/categories/%E4%BB%A3%E7%A0%81%E6%8E%A7/">代码控<span class="mdui-ripple sidebar_archives-count">4</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E6%8A%80%E6%9C%AF%E5%AE%85/">技术宅<span class="mdui-ripple sidebar_archives-count">5</span></a><a class="mdui-ripple sidebar_archives-link" href="/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念<span class="mdui-ripple sidebar_archives-count">11</span></a>
          
        </div>
      </div>
      <div class="mdui-collapse-item">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-brown">bookmark</i>
          <div class="mdui-list-item-content">标签</div>
          <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
        </div>
        <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
          
          <a class="mdui-ripple sidebar_archives-none-link" href="/tags/Android/" rel="tag">Android<span class="mdui-ripple sidebar_archives-none-count">1</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/C/" rel="tag">C++<span class="mdui-ripple sidebar_archives-none-count">3</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/JavaScript/" rel="tag">JavaScript<span class="mdui-ripple sidebar_archives-none-count">1</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/JetBrains/" rel="tag">JetBrains<span class="mdui-ripple sidebar_archives-none-count">2</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/Kotlin/" rel="tag">Kotlin<span class="mdui-ripple sidebar_archives-none-count">1</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/PyCharm/" rel="tag">PyCharm<span class="mdui-ripple sidebar_archives-none-count">1</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/Python/" rel="tag">Python<span class="mdui-ripple sidebar_archives-none-count">1</span></a><a class="mdui-ripple sidebar_archives-none-link" href="/tags/%E9%9A%8F%E6%83%B3/" rel="tag">随想<span class="mdui-ripple sidebar_archives-none-count">13</span></a>
          
        </div>
      </div>
      <a href="/about" class="mdui-list-item mdui-ripple">
        <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-purple">person</i>
        <div class="mdui-list-item-content">关于</div>
      </a>
    </div>

    <div class="mdui-divider"></div>

    <div class="mdui-list" mdui-collapse="{accordion: true}">
      
      <a href="/downloads" class="mdui-list-item mdui-ripple">资源下载</a>
      
      <a href="https://thuinfo.net/" class="mdui-list-item mdui-ripple">THUInfo</a>
      
      <a href="https://www.saiblo.net/" class="mdui-list-item mdui-ripple">Saiblo</a>
      
      <div class="mdui-collapse-item">
        <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
          <div class="mdui-list-item-content">友情链接</div>
          <i class="mdui-list-item-icon mdui-icon material-icons">link</i>
        </div>
        <div class="mdui-collapse-item-body mdui-list mdui-list-dense">
          
          <a href="https://www.dilant.cn/" target="_blank" class="mdui-list-item mdui-ripple mdui-p-l-2 mdui-text-color-theme-accent" style="justify-content: center;">迪兰特的小屋</a>
          
          <a href="https://ashitemaru.github.io/" target="_blank" class="mdui-list-item mdui-ripple mdui-p-l-2 mdui-text-color-theme-accent" style="justify-content: center;">Ashitemaru</a>
          
          <a href="https://zcy.moe/" target="_blank" class="mdui-list-item mdui-ripple mdui-p-l-2 mdui-text-color-theme-accent" style="justify-content: center;">猫猫窝</a>
          
          
        </div>
      </div>
    </div>
  </aside>
  <main id="main" class="mdui-m-t-5 fadeIn animated">
  
<link rel="stylesheet" href="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css">

  <style>#main article .mdui-card-content .center-block{display:block!important;margin-right:auto!important;margin-left:auto!important}</style>
  <article class="mdui-card mdui-m-b-5">
    
    <header class="mdui-card-media">
      <img src="/images/random/material-9.png" style="max-height: 240px;">
      <div class="mdui-card-media-covered">
        <div class="mdui-card-primary">
          <div class="mdui-card-primary-title">THUInfo踩坑记录（一）</div>
		  
            <div class="mdui-card-primary-subtitle"><i class="iconfont">&#xe697;</i> 2020-02-13 / <i class="iconfont">&#xe601;</i> UNIDY</div>
	      
        </div>
      </div>
      <div class="mdui-card-menu">
        
          <button class="mdui-btn mdui-btn-icon mdui-text-color-white" mdui-menu="{target: '#qrcode', align: 'right'}"><i class="mdui-icon material-icons">devices</i></button>
          <ul class="mdui-menu" id="qrcode">
            
              <li class="mdui-menu-item"><a class="mdui-text-center mdui-ripple">在移动端上查看</a></li>
            
            <li class="mdui-menu-item" disabled>
              <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAAB20lEQVR42u3awZKCQAwEUP//p3evHhbsHmBR8+ZEKWgeh9QkmcfPV6wHBgYGBgYGBsbbMB7x2rr/+fOt6+dP/giojAEDA2Mm40Vq2w1r63o/xCMxYGBgTGbkyTQPN382jwEDAwMj+ok40Dx0DAwMjCsSbr6lS14KBgYGxllFbJI0oxI0fhYDAwNjbTBwxfUN8w0MDIwPYZxw6CFu+ieJ9bYzIxgYGG/MaFv8bUGbfNsWtBgYGNMYa62xc1c7VMDAwJjGSFr87WhzH5w8G7XwMDAwxjDyUnMtxGRDuUbCwMDAyA9AtIk1+cd6hImBgfHVjLV22FlHu9pxJgYGxkxG3lZbOzxx1nYQAwMDIwmuHQzk44dkLIGBgTGZ0R6kaDd8+aYz/xYDA2MyYw3WjiRz3qHDFhgYGF/NaP9ybVSw1ubDwMDAOL5pq8eQZUsOAwMDI2915ak5T+ht8w4DA2MOo11rbf381SSpFgMDYxqjTXl50609ioGBgYGxz0iSbH4UY619Vt+JgYExknFWQZtv/vLCNRoMYGBgYFwwpDwykMDAwMBItoD5ALLFRwUzBgbGSMbxQxJtmdqSMDAwJjPWBgNtWz8vVv91voGBgfH2jM9dGBgYGBgYGBi3rl8E+M8UWIn/ywAAAABJRU5ErkJggg==">
            </li>
          </ul>
        
        
      </div>
    </header>
	
    <div class="mdui-card-content mdui-typo">
      <p>去年年底，我开始着手写<a href="https://github.com/UNIDY2002/THUInfo">THUInfo</a>。经过一个多月的磕磕绊绊，我也总算是做出了一点东西——虽然我也知道，这距离一个成熟的APP还有很长一段距离，更何况我也只做出了Android版本。</p>
<p>眼瞅着就要进入常规的学习状态了，各门课的老师未见其人，已见其任务，THUInfo的开发可以暂缓一段时间了。回顾这一个多月，编程水平不见得有多少提升，<strong>奇怪的知识倒是增加了不少</strong>。我觉得自己有必要将一些内容记录下来，即使没人看，也算是帮助自己温故而知新吧。<del>（实则突然找到可以写成博客的素材了）</del></p>
<hr>
<p><strong>我毕竟刚刚接触Android，很多认识也都停留在表面，没有太多接触源码的东西，因此我现阶段写下的内容，只管能用就行。</strong></p>
<p>第一部分，我打算写点当前少有教程提到的内容：页面导航（<code>Navigation</code>），以及可配套食用的顶部工具栏（<code>Toolbar</code>）、底部导航栏（<code>BottomNavigationView</code>）和侧边抽屉（<code>DrawerLayout</code>）。</p>
<h1 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h1><p><code>Navigation</code>能做什么？</p>
<p><strong>我们经常需要处理页面之间的切换。</strong>以<code>THUInfo</code>为例，主页、动态、计划之间的切换就是基本操作。幸而，Google于2018年推出<code>Android Jetpack</code>，其中的<code>Navigation</code>模块可以帮助开发者<strong>使用少量代码轻松地实现这一需求</strong>。</p>
<p><strong>此外，我们的需求往往不止于三四个根页面之间的切换。</strong>例如，在主页页面之下，我们还要有教室资源、消费查询等子页面。<strong>并且，我们还希望，在这些子页面中，返回键能够得到正确的处理（即回到上级页面），屏幕左上角也要相应地设置一个虚拟的返回按钮。</strong>而这些需求，借助<code>Navigation</code>，均可轻松得到实现。</p>
<p>那么，<code>Navigation</code>到底是怎么一回事呢？<code>Navigation</code>最基本的思路就是，<strong>设定一个容器<code>fragment</code><strong>（注：新版<code>Navigation</code>推荐使用<code>FragmentContainerView</code>，不过我还没研究），</strong>将其标记为宿主（<code>NavHostFragment</code>），由<code>NavController</code>进行管理。实际运用时如要切换页面，只需替换掉该<code>fragment</code>填充的内容即可。</strong>此外，<code>NavController</code>切换页面时，会自动维护返回栈，从而可进一步实现返回键的处理。</p>
<p>从设计理念上讲，通过<code>Navigation</code>可以将不同的页面借助<code>fragment</code>进行关联，而无需创建更多的<code>activity</code>——这也符合了“一个APP只用一个<code>activity</code>”的理念。</p>
<hr>
<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><h2 id="懒人模式"><a href="#懒人模式" class="headerlink" title="懒人模式"></a>懒人模式</h2><p>在<code>New Project</code>中选择<code>Bottom Navigation Activity</code>作为模板就可以了。</p>
<p>不过，看例程有可能看得云里雾里的，而且如果想把它迁移到已有项目中也要费一番周折，<strong>所以下面我来对其中的关键步骤进行分解，谈谈如何具体操作。</strong></p>
<h2 id="自己动手"><a href="#自己动手" class="headerlink" title="自己动手"></a>自己动手</h2><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><h4 id="添加Gradle依赖"><a href="#添加Gradle依赖" class="headerlink" title="添加Gradle依赖"></a>添加Gradle依赖</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// For Java</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.navigation:navigation-fragment:2.2.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.navigation:navigation-ui:2.2.1&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For Kotlin</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.navigation:navigation-fragment-ktx:2.2.1&#x27;</span></span><br><span class="line">    implementation <span class="string">&#x27;androidx.navigation:navigation-ui-ktx:2.2.1&#x27;</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="创建第一个页面"><a href="#创建第一个页面" class="headerlink" title="创建第一个页面"></a>创建第一个页面</h4><p>IDE为我们提供了图形化操作界面，可以帮助我们轻松创建一个页面。</p>
<p>在<code>res</code>下新建<code>navigation</code>目录，右击，新建一个<code>Navigation Resource File</code>（<code>root</code>为<code>navigation</code>），然后你应该会看见类似这样的代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">navigation</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/mobile_navigation&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">navigation</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着，进入<code>Design</code>或<code>Split</code>视图，你应该能看见<code>Click [icon] to add a destination</code>。点击它所指示的图标，你会看见<code>Create new destination</code>。点击，IDE会弹出<code>New Android Component</code>对话框。</p>
<p>在<code>Fragment Name</code>一栏中，填好相应的名称，例如<code>HomeFragment</code>。假如命名合理规范，下面的<code>Fragment Layout Name</code>一栏也会相应地变化，例如变成<code>fragment_home</code>。接下来，<code>Create layout XML?</code>勾上，<code>Include fragment factory methods?</code>不用勾，这样后续可以省很多事。</p>
<p>创建完成后，这一个导航文件的内容也会发生一些变化。你可以对它进行一些调整，例如<code>android:label</code>表示该<code>fragment</code>显示给用户的名称，可以根据需要改成其它值。</p>
<p>除此之外，你应该能在<code>res/layout</code>目录下发现多了一个<code>.xml</code>布局文件，你可以稍后对它进行修改。</p>
<p>而在代码部分，你应该会发现，多出了一个继承自<code>Fragment</code>的自定义类（可能是<code>HomeFragment</code>）。这个类将会负责管理你所创建的这个页面的生命周期。比如，你会重载<code>onStart</code>方法，从而设定这个页面启动时的行为。</p>
<hr>
<h4 id="设置导航菜单"><a href="#设置导航菜单" class="headerlink" title="设置导航菜单"></a>设置导航菜单</h4><p>在<code>res</code>下新建<code>menu</code>目录，在<code>menu</code>目录下创建一个<code>bottom_nav_menu.xml</code>（文件名随意，这里加<code>bottom</code>为了与之后的侧边抽屉区分）。里面的内容大概长这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">menu</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/homeFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:icon</span>=<span class="string">&quot;@drawable/ic_home_black_24dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:title</span>=<span class="string">&quot;@string/title_home&quot;</span>/&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">menu</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我觉得已经非常直白了，就不再赘述了。</p>
<p><strong>不过有一点，貌似这儿的<code>id</code>要和你在<code>navigation</code>文件中对应页面的<code>id</code>保持一致。</strong></p>
<hr>
<h4 id="去掉默认标题栏"><a href="#去掉默认标题栏" class="headerlink" title="去掉默认标题栏"></a>去掉默认标题栏</h4><p>Google为Android应用提供了默认的标题栏，但实践表明，预设的标题栏太丑了，且难以定制。因此，我们先要将其去掉，以便后面设置更加灵活的<code>Toolbar</code>。</p>
<p>方法很简单，找到<code>res/values/styles.xml</code>，将<code>AppTheme</code>的<code>parent</code>改成<code>Theme.AppCompat.Light.NoActionBar</code>即可。</p>
<p>接着，为设置<code>Toolbar</code>稍作准备，设置一下<code>Toolbar</code>的主题样式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;ToolbarTheme&quot;</span>&gt;</span><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;colorControlNormal&quot;</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textColorPrimary&quot;</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:background&quot;</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>colorControlNormal</code>和<code>android:textColorPrimary</code>分别是工具栏按钮和标题文字的颜色，至于是<code>white</code>还是<code>black</code>取决于背景色。</p>
<hr>
<h4 id="添加宿主容器"><a href="#添加宿主容器" class="headerlink" title="添加宿主容器"></a>添加宿主容器</h4><p>我们一般会选择一个“模板页面”，腾出一块地方安排宿主容器。例如，在<code>THUInfo</code>中，我就将宿主容器放到了主页面<code>activity_main.xml</code>中（注意不是“主页”，“主页”“动态”“计划”是平行的三个模块）。</p>
<p>你的布局文件大概会像这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.appcompat.widget.Toolbar</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;?attr/actionBarSize&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:theme</span>=<span class="string">&quot;@style/ToolbarTheme&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">fragment</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/nav_host_fragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;androidx.navigation.fragment.NavHostFragment&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;0dp&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">&quot;@dimen/activity_vertical_margin&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:defaultNavHost</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintTop_toBottomOf</span>=<span class="string">&quot;@id/toolbar&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toTopOf</span>=<span class="string">&quot;@id/bottom_nav_view&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:navGraph</span>=<span class="string">&quot;@navigation/mobile_navigation&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.bottomnavigation.BottomNavigationView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/bottom_nav_view&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:background</span>=<span class="string">&quot;?android:attr/windowBackground&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:menu</span>=<span class="string">&quot;@menu/bottom_nav_menu&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>稍微提几点。</p>
<ul>
<li>第16行，<code>fragment</code>的<code>id</code>，会在之后指定<code>NavController</code>时用到。</li>
<li>第17行，作用在于将该<code>fragment</code>标记为宿主。</li>
<li>第19行，Google的例程有点问题，在<code>ConstraintLayout</code>下会自动填满整个屏幕。我把它改成了<code>0dp</code>，这样可以指定它竖直方向填充的上下限。</li>
<li>第21行，将其设定为<code>defaultNavHost</code>，这样<code>NavController</code>在处理返回键时，就能知道，是在对这一个<code>NavHost</code>进行操作。</li>
<li>第24行，指定该宿主执行相应<code>navGraph</code>中页面的切换。</li>
<li>第32行，将<code>menu</code>设置为刚刚设好的导航菜单。</li>
</ul>
<p>至此，准备工作已经就绪，下面就可以看代码了。</p>
<hr>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MainActivity</span> : <span class="type">AppCompatActivity</span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> appBarConfiguration: AppBarConfiguration</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> navController: NavController</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> toolbar: Toolbar</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> topLevelDestinationIds = setOf(R.id.homeFragment, R.id.newsFragment, R.id.scheduleFragment)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        toolbar = findViewById(R.id.toolbar)</span><br><span class="line">        setSupportActionBar(toolbar)</span><br><span class="line"></span><br><span class="line">        navController = findNavController(R.id.nav_host_fragment)</span><br><span class="line">        appBarConfiguration = AppBarConfiguration(topLevelDestinationIds)</span><br><span class="line">        setupActionBarWithNavController(navController, appBarConfiguration)</span><br><span class="line">        findViewById&lt;BottomNavigationView&gt;(R.id.bottom_nav_view).setupWithNavController(navController)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><del>（有机会整一个<code>Kotlin</code>的语法高亮……IDE里面五彩斑斓的，搬到网页上就全是黑的了……）</del></p>
<ul>
<li>第7行，将它们作为<code>top level destinations</code>拎出来，既能突出其特殊地位，也方便<code>NavController</code>进行处理。</li>
<li>第13、14行，设置<code>Toolbar</code>。</li>
<li>第16行，获取<code>NavController</code>。<strong>关于<code>findNavController</code>有一个注意点，后面再说。</strong></li>
<li>第17、18行，将<code>NavController</code>与标题栏（这里是<code>toolbar</code>）进行绑定。</li>
<li>第19行，将<code>NavController</code>与底部导航栏进行绑定。</li>
</ul>
<p>现在，假如一切顺利的话，程序应该就能跑起来了。</p>
<hr>
<h1 id="导航"><a href="#导航" class="headerlink" title="导航"></a>导航</h1><p>讲到这里，我们已经可以在若干个<code>top level destination</code>之间进行切换了。<strong>不过，要在不同层级的页面之间进行切换，又该如何操作呢？</strong></p>
<p>这就需要用到<code>NavController</code>的<code>navigate</code>方法了。</p>
<p><strong><code>navigate</code>方法的签名如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">navigate</span><span class="params">(<span class="type">int</span> resId)</span></span><br></pre></td></tr></table></figure>

<p>它的一个作用是，提供一个目标的<code>resId</code>，从而让该<code>NavController</code>实例切换至这个目标。</p>
<p>这里有两个问题：目标的<code>resId</code>如何提供，以及<code>NavController</code>实例如何找到。</p>
<hr>
<h2 id="目标的resId如何提供？"><a href="#目标的resId如何提供？" class="headerlink" title="目标的resId如何提供？"></a>目标的<code>resId</code>如何提供？</h2><p>具体手法上与<a href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2">#创建第一个页面</a>的操作类似，<code>resId</code>就是你所创建的对应页面的<code>id</code>，在此不再细讲。</p>
<h2 id="NavController实例如何找到？"><a href="#NavController实例如何找到？" class="headerlink" title="NavController实例如何找到？"></a><code>NavController</code>实例如何找到？</h2><p>在上面的示例代码中，我使用了<code>findNavController</code>方法来获取<code>NavController</code>实例。但仔细观察后，我们发现，这里的<code>findNavController</code>是<code>Activity</code>类的一个拓展方法。<strong>那么，当我们已经在某一个<code>fragment</code>中时，又该如何获取到<code>NavController</code>实例呢？</strong></p>
<p>这时，我们看到，<code>NavHostFragment</code>下也有一个<code>findNavController</code>方法。它的签名如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> NavController <span class="title function_">findNavController</span><span class="params">(Fragment fragment)</span></span><br></pre></td></tr></table></figure>

<p>具体而言，提供一个<code>fragment</code>，它会沿着这个<code>fragment</code>的<code>parent chain</code>，一直找到其对应的<code>NavController</code>。因此，在实际应用中，代码一般长这样：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wentu_btn.setOnClickListener &#123;</span><br><span class="line">    NavHostFragment.findNavController(<span class="keyword">this</span>).navigate(R.id.wentuFragment)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的<code>this</code>指代的是代码所处的<code>HomeFragment</code>类。</p>
<p>当然，方法不止这一种。我们同样可以用<code>Fragment</code>的<code>getActivity</code>方法，先获取到对应的<code>Activity</code>，再调用<code>Activity</code>的<code>findNavController</code>方法。不过这样就需要在<code>fragment</code>中用到宿主<code>fragment</code>的<code>id</code>，我个人认为这样写不利于降低模块间的耦合度。</p>
<hr>
<h2 id="处理虚拟返回键"><a href="#处理虚拟返回键" class="headerlink" title="处理虚拟返回键"></a>处理虚拟返回键</h2><p>有了<code>NavController</code>，我们发现，物理的返回键已经能够得到正确的处理，即返回上级页面。<strong>然而，屏幕左上角的虚拟返回键却丝毫没有响应。这是为什么呢？</strong></p>
<p>其实，这也不是什么怪事。<code>NavController</code>的文档中已经指出：</p>
<blockquote>
<p>You are responsible for calling <code>NavController.navigateUp</code> to handle the Navigation button.<br>Typically this is done in <code>AppCompatActivity.onSupportNavigateUp</code>.</p>
</blockquote>
<p>因此，我们需要自己重写<code>onSupportNavigateUp</code>方法。于是，我们回到<code>MainActivity</code>中，加上这样一行代码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSupportNavigateUp</span><span class="params">()</span></span> = navController.navigateUp(appBarConfiguration)</span><br></pre></td></tr></table></figure>

<p>简简单单的一句话，就能顺利解决问题。我想，这背后的魔力，就在于<code>NavController</code>的各种优秀的方法（例如这里的<code>navigateUp</code>）。</p>
<hr>
<h1 id="侧边抽屉"><a href="#侧边抽屉" class="headerlink" title="侧边抽屉"></a>侧边抽屉</h1><p>这里，同样也有懒人模式……在<code>New Project</code>中找到<code>Navigation Drawer Activity</code>就好了。</p>
<p>不过，鉴于我们需要将抽屉直接引入当前的项目，我们最好还是手动进行整合。</p>
<hr>
<h2 id="调整布局"><a href="#调整布局" class="headerlink" title="调整布局"></a>调整布局</h2><p>我们先来回顾一下<code>THUInfo</code>的抽屉。</p>
<p><img src="/articles/thui-a-1/drawer.png" alt="THUInfo抽屉布局"></p>
<p>有两个部分。上面是一个渐变色背景的<code>headerLayout</code>，下面是<code>menu</code>。</p>
<hr>
<h3 id="headerLayout"><a href="#headerLayout" class="headerlink" title="headerLayout"></a><code>headerLayout</code></h3><p>如何画出一个渐变色的背景，并不是我们的重点。可以直接看Google的例程，也可以直接看<code>THUI</code>的源代码（<a href="https://github.com/UNIDY2002/THUInfo/blob/master/app/src/main/res/layout/nav_header_main.xml">前景</a>、<a href="https://github.com/UNIDY2002/THUInfo/blob/master/app/src/main/res/drawable/side_nav_bar.xml">背景</a>）。</p>
<h3 id="menu"><a href="#menu" class="headerlink" title="menu"></a><code>menu</code></h3><p>与<a href="#%E8%AE%BE%E7%BD%AE%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95">#设置导航菜单</a>中的操作类似，不过要创建一个新的<code>menu</code>文件，比如说<code>side_nav_menu.xml</code>。而且还更简单，因为这里不需要设置<code>icon</code>了。</p>
<hr>
<h3 id="修改布局文件"><a href="#修改布局文件" class="headerlink" title="修改布局文件"></a>修改布局文件</h3><p>这里，我们就要对<code>activity_main.xml</code>大动干戈了。</p>
<p>其实改动也不大，主要是在外面套一层<code>DrawerLayout</code>，再添加一个<code>NavigationView</code>。</p>
<p>改完之后大概长这样：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">androidx.drawerlayout.widget.DrawerLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Identical code omitted --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">com.google.android.material.navigation.NavigationView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">&quot;@+id/side_nav_view&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_gravity</span>=<span class="string">&quot;start&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:headerLayout</span>=<span class="string">&quot;@layout/nav_header_main&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">app:menu</span>=<span class="string">&quot;@menu/side_nav_menu&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">androidx.drawerlayout.widget.DrawerLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>基本上还是比较直白的，没有多少可说的。有一点，就是Google的例程上有两处<code>android:fitsSystemWindows=&quot;true&quot;</code>。有没有这句话的区别，这里主要体现在，程序进行绘制时是否算进系统顶部的透明状态栏。</p>
<hr>
<h2 id="修改源代码"><a href="#修改源代码" class="headerlink" title="修改源代码"></a>修改源代码</h2><p>下面，就是修改源代码了。主要有两处要改。</p>
<p>第一处，是将<code>appBarConfiguration = AppBarConfiguration(topLevelDestinationIds)</code>改成<code>appBarConfiguration = AppBarConfiguration(topLevelDestinationIds, findViewById(R.id.drawer_layout))</code>，从而将这一<code>DrawerLayout</code>绑定进去。</p>
<p>第二处，是要处理抽屉里的选项的点击指令。这里，我通过重写<code>onCreateOptionsMenu</code>方法来实现。（这一块我也没弄清楚为什么要在这里重载。）</p>
<p>具体而言：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateOptionsMenu</span><span class="params">(menu: <span class="type">Menu</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    side_nav_view.setNavigationItemSelectedListener &#123;</span><br><span class="line">        <span class="keyword">when</span> (it.itemId) &#123;</span><br><span class="line">            <span class="comment">// Do something</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>// Do something</code>的部分对点击的选项进行处理。其中，<code>itemId</code>为刚刚添加的<code>menu</code>的项目对应的<code>id</code>。</p>
<hr>
<p>到此为止，运行程序，我们已经可以通过<code>Navigation</code>实现页面之间的切换，并能够配合<code>Toolbar</code>、<code>BottomNavigationView</code>和<code>DrawerLayout</code>一起食用。最后，我想关于定制<code>Toolbar</code>做一点补充。</p>
<h1 id="定制Toolbar"><a href="#定制Toolbar" class="headerlink" title="定制Toolbar"></a>定制<code>Toolbar</code></h1><p>在实际应用中，我们有时会希望<code>Toolbar</code>的标题文字和按钮图标能够动态地改变。这又该如何实现呢？</p>
<hr>
<h2 id="动态设置标题文字"><a href="#动态设置标题文字" class="headerlink" title="动态设置标题文字"></a>动态设置标题文字</h2><p>以<code>THUInfo</code>为例，在查询教室资源时，当用户进入了具体的教学楼页面（例如“六教”），标题栏也相应地变成了“六教”。<a href="https://github.com/UNIDY2002/THUInfo/blob/master/app/src/main/java/com/unidy2002/thuinfo/ui/home/ClassroomTableFragment.kt">代码</a>其实很简单：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(activity <span class="keyword">as</span>? AppCompatActivity)?.supportActionBar?.title = <span class="string">&quot;&#123;Your Title&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<p>此处，先获得<code>fragment</code>所在的<code>activity</code>，并将其转化为<code>AppCompatActivity</code>，因为<code>getSupportActionBar</code>是<code>AppCompatActivity</code>的方法。得到了<code>supportActionBar</code>后，获取到<code>title</code>，我们就可以动态地进行设置了。</p>
<hr>
<h2 id="动态设置按钮图标"><a href="#动态设置按钮图标" class="headerlink" title="动态设置按钮图标"></a>动态设置按钮图标</h2><p>在<code>THUInfo</code>中，当收到新邮件时，左上角的按钮图标会变成带小红点的三道杠。这又是如何实现的呢？</p>
<p>首先，我们当然是要先准备好新图标。<strong>这里比较重要的是，图标的大小要调整好，比如设置成24dp*24dp，因为<code>Toolbar</code>貌似不会对图标进行自动缩放。</strong></p>
<p>代码跟上面差不多，得到<code>supportActionBar</code>之后，设置<code>navigationIcon</code>属性，即可实现。</p>
<p>当然，这有点暴力修改的意味在里面。因此，要想显得不那么暴力，需要考虑一些问题。最主要的，就是设置<code>navigationIcon</code>的过程是一瞬间完成的，中间的过渡动画就没有了。</p>
<p>还有两个小问题。</p>
<ol>
<li><p>每30秒重新获取一次未读邮件情况，相应地也要刷新一下左上角的图标。然而，**我忘了还要判断当前页面是否为<code>top level destiniation</code>**，导致的结果是，明明左上角应该是一个返回键，突然就变成带小红点的三道杠了。<br>看一下修改之后的代码片段：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (navController.currentDestination?.id <span class="keyword">in</span> topLevelDestinationIds) &#123;</span><br><span class="line">    <span class="comment">// Update badge</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>然而，仅仅每30秒刷新一次显然不够——当用户重新来到<code>top level destination</code>时，也应刷新一次。这时，我们就要监听<code>NavController</code>的目标变化了：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">navController.addOnDestinationChangedListener &#123; _, destination, _ -&gt;</span><br><span class="line">    <span class="keyword">if</span> (destination.id <span class="keyword">in</span> topLevelDestinationIds) refreshBadge()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><del>（所以，为什么不自己做一个<code>Toolbar</code>呢）</del></p>
<p><code>THUInfo</code>中处理小红点的<a href="https://github.com/UNIDY2002/THUInfo/blob/master/app/src/main/java/com/unidy2002/thuinfo/MainActivity.kt">详细代码</a>在<code>MainActivity.kt</code>中。</p>
<hr>
<p>好了，感觉自己也写了不少了，也算是把整个<code>Navigation</code>的来龙去脉都简单地梳理了一遍。</p>
<p>既然……我也不太会写结束语，那就，先这样结束吧~</p>

      
        <blockquote class="mdui-m-t-5">
          
          <strong>本文链接：</strong><a href="https://www.unidy.cn/articles/thui-a-1/">https://www.unidy.cn/articles/thui-a-1/</a>
        </blockquote>
	  
      
    </div>
    <footer class="mdui-card-actions">
      
        <a class="mdui-ripple article_categories-link" href="/categories/%E4%BB%A3%E7%A0%81%E6%8E%A7/">代码控</a>
      
      
        <a class="mdui-ripple article_tags-none-link" href="/tags/Android/" rel="tag">Android</a><a class="mdui-ripple article_tags-none-link" href="/tags/Kotlin/" rel="tag">Kotlin</a>
      
    </footer>
    
  </article>
  
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>

  <script>$("#main article .mdui-card-content img.fancybox").on("click",function(e){$.fancybox.open({src:$(this).attr("src")});});</script>


  <nav id="paginator">
    
      <a rel="prev" class="extend prev" href="/articles/include/">
        <button aria-label="prev" class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_back</i></button>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上一篇
      </a>
    
    <div class="spacer"></div>
    
      <a rel="next" class="extend next" href="/articles/intro-to-pycharm/">
        下一篇&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <button aria-label="next" class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-btn-icon mdui-color-theme-accent mdui-ripple"><i class="mdui-icon material-icons">arrow_forward</i></button>
      </a>
    
  </nav>


  <div id="comment" class="mdui-m-t-5">
    <div class="vcomment"></div>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.slim.min.js"></script>
<script src="https://unpkg.com/leancloud-storage@4.12.2/dist/av-min.js"></script>
<script src="https://unpkg.com/valine@1.4.18/dist/Valine.min.js"></script>
<script>
  var GUEST_INFO = ['nick', 'mail', 'link'];
  var guest_info = 'nick,mail'.split(',').filter(function (item) {
    return GUEST_INFO.indexOf(item) > -1;
  });
  var notify = 'false' === 'true';
  var verify = 'false' === 'true';
  new Valine({
    av: AV,
    el: '.vcomment',
    notify: notify,
    verify: verify,
    appId: "ewlT3sErBcbbAdwPXrhxRNfg-gzGzoHsz",
    appKey: "MQgeLEsEGHvbeG6SjqBaiUad",
    placeholder: "一起来评论呀~",
    pageSize: '',
    avatar: 'mp',
    lang: '',
    guest_info: guest_info
  });
</script>

  </div>



  <div style="position: fixed !important; right: 16px; top: 30%;">
    <button class="mdui-fab mdui-fab-mini mdui-ripple" mdui-menu="{target: '#toc'}"><i class="mdui-icon material-icons">format_list_numbered</i></button>
    <ul class="mdui-menu" id="toc">
      <li class="mdui-menu-item" disabled><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%87%92%E4%BA%BA%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">懒人模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B"><span class="toc-number">2.2.</span> <span class="toc-text">自己动手</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">2.2.1.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0Gradle%E4%BE%9D%E8%B5%96"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">添加Gradle依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E9%A1%B5%E9%9D%A2"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">创建第一个页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E5%AF%BC%E8%88%AA%E8%8F%9C%E5%8D%95"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">设置导航菜单</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%BB%E6%8E%89%E9%BB%98%E8%AE%A4%E6%A0%87%E9%A2%98%E6%A0%8F"><span class="toc-number">2.2.1.4.</span> <span class="toc-text">去掉默认标题栏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%AE%BF%E4%B8%BB%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.1.5.</span> <span class="toc-text">添加宿主容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.2.</span> <span class="toc-text">代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA"><span class="toc-number">3.</span> <span class="toc-text">导航</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87%E7%9A%84resId%E5%A6%82%E4%BD%95%E6%8F%90%E4%BE%9B%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">目标的resId如何提供？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NavController%E5%AE%9E%E4%BE%8B%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">NavController实例如何找到？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E8%99%9A%E6%8B%9F%E8%BF%94%E5%9B%9E%E9%94%AE"><span class="toc-number">3.3.</span> <span class="toc-text">处理虚拟返回键</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%A7%E8%BE%B9%E6%8A%BD%E5%B1%89"><span class="toc-number">4.</span> <span class="toc-text">侧边抽屉</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E5%B8%83%E5%B1%80"><span class="toc-number">4.1.</span> <span class="toc-text">调整布局</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#headerLayout"><span class="toc-number">4.1.1.</span> <span class="toc-text">headerLayout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#menu"><span class="toc-number">4.1.2.</span> <span class="toc-text">menu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%B8%83%E5%B1%80%E6%96%87%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text">修改布局文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">修改源代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6Toolbar"><span class="toc-number">5.</span> <span class="toc-text">定制Toolbar</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E6%A0%87%E9%A2%98%E6%96%87%E5%AD%97"><span class="toc-number">5.1.</span> <span class="toc-text">动态设置标题文字</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E6%8C%89%E9%92%AE%E5%9B%BE%E6%A0%87"><span class="toc-number">5.2.</span> <span class="toc-text">动态设置按钮图标</span></a></li></ol></li></ol></li>
    </ul>
  </div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.slim.min.js"></script>
<script src='https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.10/clipboard.min.js'></script>
<script src='/lib/btn-copy.js'></script>
</main>
<footer id="footer" class="mdui-m-t-5 mdui-p-y-3 mdui-color-theme">
  <div class="mdui-p-y-0 mdui-text-center">
    
    
    
    
    
    
    
      <a href="https://github.com/UNIDY2002/" target="_blank"><i class="mdui-p-a-1 mdui-icon iconfont mdui-text-color-theme-a100">&#xe7ab;</i></a>
    
    
    
    
    
    
  </div>
  <div class="mdui-p-y-1 mdui-text-center">
    <a target="_blank" href="https://beian.miit.gov.cn/" class="mdui-text-color-theme-a100">京ICP备2021021102号-1</a>
    <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802035479" class="mdui-text-color-theme-a100"><img src="/images/beian.png" style="padding-left: 1px;padding-right: 2px"/>京公网安备 11010802035479号</a>
  </div>
  <div class="mdui-p-y-1 mdui-text-center">
    &copy; 2022 | <i class="fa fa-user"></i> UNIDY
    
  </div>
</footer>

  <button id="gotop" class="mdui-fab mdui-fab-fixed mdui-fab-hide mdui-ripple mdui-color-theme-accent"><i class="mdui-icon material-icons">arrow_upward</i></button>
  
  
<script src="https://unpkg.com/mdui@1.0.1/dist/js/mdui.js"></script>
<script src="/lib/script.js"></script>

</body>
</html>
